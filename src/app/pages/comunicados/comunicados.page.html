<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button class="menu-button-externo"></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="page-content">
    <div class="title">Hist√≥rico de Recados Recebidos: <span class="counter">({{ comunicados.length }})</span></div>
    
    <ng-container *ngIf="comunicados && comunicados.length > 0; else vazio">
      <div 
        class="comunicado-card" 
        *ngFor="let comunicado of comunicados; trackBy: trackByComunicado" 
        (click)="openComunicado(comunicado)"
      >
        <div class="comunicado-avatar" [ngClass]="comunicado.type || 'default'">{{ comunicado.emoji || 'üìù' }}</div>
        <div class="comunicado-content">
          <div class="comunicado-header">
            <h3>{{ comunicado.title || 'Sem t√≠tulo' }}</h3>
          </div>
          <p>{{ comunicado.preview || (comunicado.content | slice:0:100) }}</p>
        </div>
        <div class="comunicado-meta">
          <span 
            class="comunicado-badge" 
            [ngClass]="comunicado.type" 
            *ngIf="comunicado.type === 'urgent' || comunicado.type === 'info'"
          >
            {{ comunicado.type === 'urgent' ? 'URGENTE' : 'INFO' }}
          </span>
          <span class="comunicado-date">{{ formatarData(comunicado.data) || comunicado.date || 'Data n√£o informada' }}</span>
        </div>
      </div>
    </ng-container>

    <ng-template #vazio>
      <div class="empty-state">
        <div class="empty-icon">üìù</div>
        <h3>Nenhum comunicado enviado</h3>
        <p>Voc√™ ainda n√£o enviou nenhum comunicado.</p>
      </div>
    </ng-template>


  </div>

  <!-- Overlay/Modal de detalhes do comunicado -->
  <div class="comunicado-overlay" *ngIf="comunicadoSelecionado" (click)="fecharDetalhes()">
    <div class="comunicado-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Detalhes do Comunicado</h2>
        <button class="close-btn" (click)="fecharDetalhes()">√ó</button>
      </div>
      
      <div class="modal-content">
        <!-- Cabe√ßalho -->
        <div class="comunicado-header-modal">
          <div class="comunicado-avatar-modal" [ngClass]="comunicadoSelecionado.type || 'default'">
            {{ comunicadoSelecionado.emoji || 'üìù' }}
          </div>
          <div class="comunicado-info-modal">
            <h3 class="comunicado-titulo-modal">{{ comunicadoSelecionado.title || 'Sem t√≠tulo' }}</h3>
            <div class="comunicado-meta-modal">
              <span class="comunicado-data-modal">{{ formatarData(comunicadoSelecionado.data) || comunicadoSelecionado.date || 'Data n√£o informada' }}</span>
              <span 
                class="comunicado-badge-modal" 
                [ngClass]="comunicadoSelecionado.type" 
                *ngIf="comunicadoSelecionado.type === 'urgent' || comunicadoSelecionado.type === 'info'"
              >
                {{ comunicadoSelecionado.type === 'urgent' ? 'URGENTE' : 'INFO' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Informa√ß√µes -->
        <div class="info-section-modal">
          <div class="info-item-modal">
            <span class="info-label-modal">De:</span>
            <span class="info-value-modal">{{ comunicadoSelecionado.from || 'docente@crecheapp.com' }}</span>
          </div>
          <div class="info-item-modal">
            <span class="info-label-modal">Para:</span>
            <span class="info-value-modal">{{ comunicadoSelecionado.to || 'Destinat√°rios n√£o especificados' }}</span>
          </div>
          <div class="info-item-modal" *ngIf="comunicadoSelecionado.cc">
            <span class="info-label-modal">Cc:</span>
            <span class="info-value-modal">{{ comunicadoSelecionado.cc }}</span>
          </div>
          <div class="info-item-modal" *ngIf="comunicadoSelecionado.bcc">
            <span class="info-label-modal">Bcc:</span>
            <span class="info-value-modal">{{ comunicadoSelecionado.bcc }}</span>
          </div>
        </div>

        <!-- Mensagem -->
        <div class="mensagem-section-modal">
          <h4 class="mensagem-title-modal">Mensagem:</h4>
          <div class="mensagem-content-modal">
            <p class="mensagem-texto-modal">{{ comunicadoSelecionado.content }}</p>
          </div>
        </div>

        <!-- A√ß√µes -->
        <div class="actions-modal">
          <button class="btn-modal btn-secondary" (click)="fecharDetalhes()">Fechar</button>
        </div>
      </div>
    </div>
  </div>
</ion-content>