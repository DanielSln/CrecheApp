<ion-header>
  <ion-toolbar class="compose-toolbar">
    <ion-buttons slot="start">
      <ion-button class="close-btn" (click)="cancelar()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
    
    <ion-title class="compose-title">Novo Comunicado</ion-title>
    
    <ion-buttons slot="end">
      <ion-button class="action-btn" (click)="mostrarOpcoes()">
        <ion-icon name="ellipsis-vertical"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="compose-content">
  <div class="compose-container">
    
    <!-- Campo De -->
    <div class="compose-field">
      <div class="field-row">
        <div class="field-label">De:</div>
        <div class="field-content">
          <div class="from-email">docente@crecheapp.com</div>
        </div>
      </div>
    </div>

    <!-- Campo Para -->
    <div class="compose-field">
      <div class="field-row" (click)="abrirDestinatarios()" style="cursor: pointer;">
        <div class="field-label">Para:</div>
        <div class="field-content">
          <div class="recipient-display">
            {{ comunicado.to || 'Selecione os destinat√°rios' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Campo Cc/Bcc -->
    <div class="compose-field" *ngIf="showCc || showBcc">
      <div class="cc-bcc-field">
        <div class="field-row" *ngIf="showCc">
          <div class="field-label">Cc:</div>
          <div class="field-content">
            <ion-input
              class="recipient-input"
              placeholder="Com c√≥pia"
              [(ngModel)]="comunicado.cc"
            ></ion-input>
          </div>
        </div>
        <div class="field-row" *ngIf="showBcc">
          <div class="field-label">Bcc:</div>
          <div class="field-content">
            <ion-input
              class="recipient-input"
              placeholder="Com c√≥pia oculta"
              [(ngModel)]="comunicado.bcc"
            ></ion-input>
          </div>
        </div>
      </div>
    </div>

    <!-- Toggle Cc/Bcc -->
    <div class="compose-field">
      <div class="cc-bcc-toggle">
        <ion-button fill="clear" (click)="toggleCc()">
          {{ showCc ? 'Remover Cc' : 'Adicionar Cc' }}
        </ion-button>
        <ion-button fill="clear" (click)="toggleBcc()">
          {{ showBcc ? 'Remover Bcc' : 'Adicionar Bcc' }}
        </ion-button>
      </div>
    </div>

    <!-- Campo Assunto -->
    <div class="compose-field">
      <div class="field-row">
        <div class="field-label">Assunto:</div>
        <div class="field-content">
          <ion-input
            class="subject-input"
            placeholder="Assunto do comunicado"
            [(ngModel)]="comunicado.subject"
          ></ion-input>
        </div>
      </div>
    </div>

    <!-- Campo √çcone -->
    <div class="compose-field">
      <div class="field-row">
        <div class="field-label">√çcone:</div>
        <div class="field-content">
          <div class="icon-selector">
            <div class="selected-icon" (click)="toggleIconSelector()">
              <span class="icon-display">{{ comunicado.icon }}</span>
              <span class="icon-text">Selecionar √≠cone</span>
            </div>
            
            <div class="icon-grid" *ngIf="showIconSelector">
              <div 
                *ngFor="let icon of availableIcons" 
                class="icon-option"
                [class.selected]="icon === comunicado.icon"
                (click)="selectIcon(icon)"
              >
                {{ icon }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Campo Mensagem -->
    <div class="compose-field">
      <div class="compose-body">
        <ion-textarea
          class="message-textarea"
          placeholder="Escreva sua mensagem aqui..."
          [(ngModel)]="comunicado.message"
          rows="8"
          autoGrow="true"
        ></ion-textarea>
      </div>
    </div>

    <!-- Bot√µes de A√ß√£o -->
    <div class="action-buttons">
      <ion-button 
        class="send-btn" 
        expand="block" 
        (click)="enviarComunicado()"
      >
        <ion-icon name="send" slot="start"></ion-icon>
        Enviar Comunicado
      </ion-button>
      
      <div class="secondary-actions">
        <ion-button 
          class="secondary-btn" 
          fill="clear" 
          (click)="salvarRascunho()"
        >
          <ion-icon name="document" slot="start"></ion-icon>
          Salvar Rascunho
        </ion-button>
        
        <ion-button 
          class="secondary-btn" 
          fill="clear" 
          (click)="cancelar()"
        >
          <ion-icon name="close" slot="start"></ion-icon>
          <div class="text-cancel">Cancelar</div>
        </ion-button>
      </div>
    </div>

  </div>

  <!-- Modal de Destinat√°rios -->
  <div class="modal-overlay" *ngIf="showDestinatariosModal" (click)="fecharDestinatarios()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Selecionar Destinat√°rios</h3>
        <button class="close-btn-modal" (click)="fecharDestinatarios()">√ó</button>
      </div>
      
      <div class="modal-body">
        <div class="search-section">
          <input type="text" class="search-input" placeholder="Buscar..." [(ngModel)]="searchQuery" />
        </div>
        
        <div class="options-section">
          <div class="option-item" (click)="selecionarOpcao('Geral')">
            <span class="option-icon">üåç</span>
            <span class="option-text">Geral (Todos)</span>
          </div>
          <div class="option-item" (click)="selecionarOpcao('Alunos')">
            <span class="option-icon">üéì</span>
            <span class="option-text">Alunos</span>
          </div>
          <div class="option-item" (click)="selecionarOpcao('Docentes')">
            <span class="option-icon">üë®‚Äçüè´</span>
            <span class="option-text">Docentes</span>
          </div>
        </div>
        
        <div class="list-section" *ngIf="tipoSelecionado === 'Alunos'">
          <h4>Alunos Dispon√≠veis</h4>
          <div class="list-item" *ngFor="let aluno of filteredAlunos()" (click)="toggleDestinatario(aluno.nome)">
            <input type="checkbox" [checked]="isSelected(aluno.nome)" />
            <span>{{ aluno.nome }}</span>
          </div>
        </div>
        
        <div class="list-section" *ngIf="tipoSelecionado === 'Docentes'">
          <h4>Docentes Dispon√≠veis</h4>
          <div class="list-item" *ngFor="let docente of filteredDocentes()" (click)="toggleDestinatario(docente.nome)">
            <input type="checkbox" [checked]="isSelected(docente.nome)" />
            <span>{{ docente.nome }}</span>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn-confirm" (click)="confirmarDestinatarios()">Confirmar</button>
      </div>
    </div>
  </div>
</ion-content>